import"./modulepreload-polyfill-B5Qt9EMX.js";import{au as _,av as j,aw as $,a5 as J,aI as K,E as Q,a4 as X,B as Y,aj as Z,a6 as D,aJ as ee}from"./MaterialBase-D0apYRZI.js";import{M as ae}from"./meshopt_decoder.module-j6OW_3Rk.js";import{H as te}from"./HDRLoader-QyionP9_.js";import{G as ne}from"./GLTFLoader-CZoURFu4.js";import{g as oe}from"./lil-gui.module.min-BH_YJbPT.js";import{O as se}from"./OrbitControls-QPbjf6RX.js";import{L as ie}from"./LoaderElement-DklLdAaa.js";import{W as re}from"./WebGLPathTracer-BkY-ibNS.js";import{P as le}from"./ParallelMeshBVHWorker-C6VKfx-V.js";import"./BufferGeometryUtils-B2ZswfaJ.js";import"./pcg.glsl-D_3-p9wz.js";import"./PathTracingRenderer-CqRsglCw.js";import"./ggx_functions.glsl-Bslli_qd.js";import"./GenerateMeshBVHWorker-CSNZTU94.js";const de="https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/config.json",U="https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/config/",S=new URLSearchParams(window.location.search),u=parseInt(S.get("samples"))||-1,E=S.get("hideUI")==="true",ce=parseInt(S.get("tiles"))||2,me=parseInt(S.get("scale"))||1/window.devicePixelRatio,e={enable:!0,bounces:10,transmissiveBounces:10,pause:!1,multipleImportanceSampling:!0,acesToneMapping:!0,tiles:ce,scale:me,model:"",checkerboardTransparency:!0,displayImage:!1,imageMode:"overlay",imageOpacity:1,imageType:"dspbr-pt"};let c,g,w,d,r,b,a,i,s,p,k,I=!1,v=0,h;pe();async function pe(){c=document.getElementById("container"),g=document.querySelector("img"),E&&(c.style.background="transparent",document.body.style.background="transparent"),w=new ie,E||w.attach(document.body),i=new _({antialias:!0,preserveDrawingBuffer:!0}),i.physicallyCorrectLights=!0,i.toneMapping=j,i.setClearAlpha(0),c.appendChild(i.domElement),a=new re(i),a.filterGlossyFactor=.5,a.tiles.set(e.tiles),a.setBVHWorker(new le),a.multipleImportanceSampling=e.multipleImportanceSampling,p=new $;const t=window.innerWidth/window.innerHeight;s=new J(60,t,.01,500),s.position.set(-1,.25,1),k=new se(s,c),k.addEventListener("change",()=>a.updateCamera());const{scenarios:l}=await fetch(de).then(o=>o.json());h={},l.forEach(o=>h[o.name]=o),window.addEventListener("hashchange",O),O(),W()}function W(){requestAnimationFrame(W),!(a.samples>=u&&u!==-1)&&(g.style.display=e.displayImage?"inline-block":"none",g.style.opacity=e.imageMode==="side-by-side"?1:e.imageOpacity,g.style.position=e.imageMode==="side-by-side"?"initial":"absolute",g.style.width=i.domElement.style.width,g.style.height=i.domElement.style.height,!I&&(e.enable&&v===0?(a.enablePathTracing=e.enable,a.pausePathTracing=e.pause||a.samples>u&&u!==-1,a.renderSample()):(v>0||!e.enable)&&(v=Math.max(v-1,0),i.render(p,s)),a.samples>=u&&u!==-1&&requestAnimationFrame(()=>window.dispatchEvent(new Event("render-complete"))),w.setSamples(a.samples,a.isCompiling)))}function O(){if(e.model=Object.keys(h)[0],window.location.hash){const t=window.location.hash.substring(1).replaceAll("%20"," ");t in h&&(e.model=t)}he()}function f(){a.tiles!==1&&(v=1),e.checkerboardTransparency?c.classList.add("checkerboard"):c.classList.remove("checkerboard"),a.multipleImportanceSampling=e.multipleImportanceSampling,a.bounces=e.bounces,a.transmissiveBounces=e.transmissiveBounces,a.renderScale=e.scale;const t=h[e.model];p.background=t&&t.renderSkybox?p.environment:null,a.updateEnvironment()}function ge(){if(E)return;d&&d.destroy(),d=new oe,d.add(e,"model",Object.keys(h)).onChange(o=>{window.location.hash=o});const t=d.addFolder("Path Tracer");t.add(e,"enable"),t.add(e,"pause"),t.add(e,"scale",.1,1).onChange(f),t.add(e,"multipleImportanceSampling").onChange(f),t.add(e,"acesToneMapping").onChange(o=>{i.toneMapping=o?j:ee}),t.add(e,"tiles",1,10,1).onChange(o=>{a.tiles.set(o,o)}),t.add(e,"bounces",1,20,1).onChange(f),t.add(e,"transmissiveBounces",1,20,1).onChange(f);const l=d.addFolder("Comparison");l.add(e,"displayImage"),l.add(e,"imageMode",["overlay","side-by-side"]),l.add(e,"imageType",["dspbr-pt","filament","babylon","gltf-sample-viewer","model-viewer","rhodonite","stellar"]).onChange(H),l.add(e,"imageOpacity",0,1),l.add(e,"checkerboardTransparency").onChange(f)}async function he(){d&&(c.classList.remove("checkerboard"),d.destroy(),d=null),r&&(r.traverse(n=>{if(n.material){const M=n.material;for(const P in M)M[P]&&M[P].isTexture&&M[P].dispose()}}),p.remove(r)),b&&b.dispose();const t=h[e.model],{verticalFoV:l=45,lighting:o="../../../shared-assets/environments/lightroom_14b.hdr"}=t;let{orbit:m={},target:y={},dimensions:C={}}=t;m={theta:0,phi:90,radius:1,...m},y={x:0,y:0,z:0,...y},C={width:768,height:768,...C},m.radius=Math.max(m.radius,1e-5),I=!0,c.style.display="none";const q=new URL(o,U).toString(),z=new URL(t.model,U).toString().replace(/.*?glTF-Sample-Assets/,"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Assets/main"),T=new K,[N,V]=await Promise.all([new te(T).loadAsync(q),new ne(T).setMeshoptDecoder(ae).loadAsync(z,n=>{n.total!==0&&n.total>=n.loaded&&w.setPercentage(.5*n.loaded/n.total)}),new Promise(n=>T.onLoad=n)]);b=N,b.mapping=Q,p.environment=b,r=V.scene;const x=[];r.traverse(n=>{n.isLight&&n.target&&x.push(n.target)}),x.forEach(n=>n.removeFromParent());const L=new X;L.position.set(-y.x,-y.y,-y.z),L.add(r),r=L,r.updateMatrixWorld(!0),p.add(r);const F=new Y,A=new Z;F.setFromObject(r),F.getBoundingSphere(A);const R=Math.max(m.radius,A.radius);s.near=2*R/1e3,s.far=2*R,s.updateProjectionMatrix(),s.position.setFromSphericalCoords(m.radius,D.DEG2RAD*m.phi,D.DEG2RAD*m.theta);const{width:B,height:G}=C;i.setSize(B,G),i.setPixelRatio(window.devicePixelRatio),s.aspect=B/G,s.fov=l,s.updateProjectionMatrix(),k.update(),await a.setSceneAsync(p,s,{onProgress:n=>{w.setPercentage(.5+.5*n)}}),w.setCredits(t.credit||""),c.style.display="flex",I=!1,f(),ge(),H()}function H(){g.src=`https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/goldens/${e.model}/${e.imageType}-golden.png`}
//# sourceMappingURL=viewerTest-DYzmCND-.js.map
