{"version":3,"file":"materialDatabase-CnxeaWxR.js","sources":["../../example/materialDatabase.js"],"sourcesContent":["import {\r\n\tAgXToneMapping,\r\n\tScene,\r\n\tVector3,\r\n\tWebGLRenderer,\r\n} from 'three';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\r\nimport { WebGLPathTracer } from '../src/index.js';\r\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\r\nimport { LoaderElement } from './utils/LoaderElement.js';\r\nimport { getScaledSettings } from './utils/getScaledSettings.js';\r\nimport { MaterialOrbSceneLoader } from './utils/MaterialOrbSceneLoader.js';\r\nimport { RectAreaLightUniformsLib } from 'three/examples/jsm/lights/RectAreaLightUniformsLib.js';\r\n\r\nconst DB_URL = 'https://api.physicallybased.info/materials';\r\nconst CREDITS = 'Materials courtesy of \"physicallybased.info\"</br>Material orb model courtesy of USD Working Group';\r\n\r\nlet pathTracer, renderer, controls, material;\r\nlet camera, database, scene;\r\nlet loader, imgEl;\r\n\r\nconst params = {\r\n\tmaterial: null,\r\n\ttiles: 2,\r\n\tbounces: 5,\r\n\tmultipleImportanceSampling: true,\r\n\trenderScale: 1 / window.devicePixelRatio,\r\n\t...getScaledSettings(),\r\n};\r\n\r\ninit();\r\n\r\nasync function init() {\r\n\r\n\tRectAreaLightUniformsLib.init();\r\n\r\n\tloader = new LoaderElement();\r\n\tloader.attach( document.body );\r\n\r\n\timgEl = document.getElementById( 'materialImage' );\r\n\r\n\t// renderer\r\n\trenderer = new WebGLRenderer( { antialias: true } );\r\n\trenderer.toneMapping = AgXToneMapping;\r\n\trenderer.toneMappingExposure = 0.02;\r\n\tdocument.body.appendChild( renderer.domElement );\r\n\r\n\t// path tracer\r\n\tpathTracer = new WebGLPathTracer( renderer );\r\n\tpathTracer.multipleImportanceSampling = params.multipleImportanceSampling;\r\n\tpathTracer.tiles.set( params.tiles, params.tiles );\r\n\tpathTracer.textureSize.set( 2048, 2048 );\r\n\tpathTracer.filterGlossyFactor = 0.5;\r\n\r\n\t// scene\r\n\tscene = new Scene();\r\n\r\n\t// load assets\r\n\tconst [ orb, dbJson ] = await Promise.all( [\r\n\t\tnew MaterialOrbSceneLoader().loadAsync(),\r\n\t\tfetch( DB_URL ).then( res => res.json() ),\r\n\t] );\r\n\r\n\t// scene initialization\r\n\tscene.add( orb.scene );\r\n\tcamera = orb.camera;\r\n\tmaterial = orb.material;\r\n\r\n\t// move camera to the scene\r\n\tscene.attach( camera );\r\n\tcamera.removeFromParent();\r\n\r\n\t// controls\r\n\tcontrols = new OrbitControls( camera, renderer.domElement );\r\n\tcontrols.addEventListener( 'change', () => pathTracer.updateCamera() );\r\n\r\n\t// shift target\r\n\tconst fwd = new Vector3( 0, 0, - 1 ).transformDirection( camera.matrixWorld ).normalize();\r\n\tcontrols.target.copy( camera.position ).addScaledVector( fwd, 25 );\r\n\tcontrols.update();\r\n\r\n\t// database set up\r\n\tdatabase = {};\r\n\tdbJson.forEach( mat => database[ mat.name ] = mat );\r\n\tparams.material = Object.keys( database )[ 0 ];\r\n\r\n\t// initialize scene\r\n\tpathTracer.setScene( scene, camera );\r\n\tloader.setPercentage( 1 );\r\n\tloader.setCredits( CREDITS );\r\n\r\n\tonParamsChange();\r\n\tonResize();\r\n\twindow.addEventListener( 'resize', onResize );\r\n\r\n\t// gui\r\n\tconst gui = new GUI();\r\n\tgui.add( params, 'material', Object.keys( database ) ).onChange( onParamsChange );\r\n\r\n\tconst ptFolder = gui.addFolder( 'Path Tracing' );\r\n\tptFolder.add( params, 'multipleImportanceSampling' ).onChange( onParamsChange );\r\n\tptFolder.add( params, 'tiles', 1, 4, 1 ).onChange( value => {\r\n\r\n\t\tpathTracer.tiles.set( value, value );\r\n\r\n\t} );\r\n\tptFolder.add( params, 'bounces', 1, 30, 1 ).onChange( onParamsChange );\r\n\tptFolder.add( params, 'renderScale', 0.1, 1 ).onChange( onParamsChange );\r\n\r\n\tanimate();\r\n\r\n}\r\n\r\nfunction onResize() {\r\n\r\n\trenderer.setSize( window.innerWidth, window.innerHeight );\r\n\trenderer.setPixelRatio( window.devicePixelRatio );\r\n\tcamera.aspect = window.innerWidth / window.innerHeight;\r\n\tcamera.updateProjectionMatrix();\r\n\tpathTracer.updateCamera();\r\n\r\n}\r\n\r\nfunction applyMaterialInfo( info, material ) {\r\n\r\n\t// defaults\r\n\tmaterial.color.set( 0xffffff );\r\n\tmaterial.transmission = 0.0;\r\n\tmaterial.attenuationDistance = 1;\r\n\tmaterial.attenuationColor.set( 0xffffff );\r\n\tmaterial.specularColor.set( 0xffffff );\r\n\tmaterial.metalness = 0.0;\r\n\tmaterial.roughness = 1.0;\r\n\tmaterial.ior = 1.5;\r\n\tmaterial.thickness = 1.0;\r\n\tmaterial.iridescence = 0.0;\r\n\tmaterial.iridescenceIOR = 1.0;\r\n\tmaterial.iridescenceThicknessRange = [ 0, 0 ];\r\n\r\n\t// apply database values\r\n\tif ( info.specularColor ) material.specularColor.setRGB( ...info.specularColor );\r\n\tif ( 'metalness' in info ) material.metalness = info.metalness;\r\n\tif ( 'roughness' in info ) material.roughness = info.roughness;\r\n\tif ( 'ior' in info ) material.ior = info.ior;\r\n\tif ( 'transmission' in info ) material.transmission = info.transmission;\r\n\tif ( 'thinFilmThickness' in info ) {\r\n\r\n\t\tmaterial.iridescence = 1.0;\r\n\t\tmaterial.iridescenceIOR = info.thinFilmIor;\r\n\t\tmaterial.iridescenceThicknessRange = [ info.thinFilmThickness, info.thinFilmThickness ];\r\n\r\n\t}\r\n\r\n\tif ( material.transmission ) {\r\n\r\n\t\tif ( info.color ) {\r\n\r\n\t\t\tmaterial.attenuationColor.setRGB( ...info.color );\r\n\r\n\t\t}\r\n\r\n\t\tif ( info.transmissionDepth ) {\r\n\r\n\t\t\tmaterial.attenuationDistance = info.transmissionDepth;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmaterial.attenuationDistance = 1;\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\tif ( info.color ) {\r\n\r\n\t\t\tmaterial.color.setRGB( ...info.color );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\timgEl.src = info.reference[ 0 ];\r\n\r\n}\r\n\r\nfunction onParamsChange() {\r\n\r\n\tapplyMaterialInfo( database[ params.material ], material );\r\n\r\n\tpathTracer.multipleImportanceSampling = params.multipleImportanceSampling;\r\n\tpathTracer.renderScale = params.renderScale;\r\n\tpathTracer.bounces = params.bounces;\r\n\tpathTracer.updateMaterials();\r\n\r\n}\r\n\r\nfunction animate() {\r\n\r\n\trequestAnimationFrame( animate );\r\n\tpathTracer.renderSample();\r\n\tloader.setSamples( pathTracer.samples, pathTracer.isCompiling );\r\n\r\n}\r\n"],"names":["DB_URL","CREDITS","pathTracer","renderer","controls","material","camera","database","scene","loader","imgEl","params","getScaledSettings","init","RectAreaLightUniformsLib","LoaderElement","WebGLRenderer","AgXToneMapping","WebGLPathTracer","Scene","orb","dbJson","MaterialOrbSceneLoader","res","OrbitControls","fwd","Vector3","mat","onParamsChange","onResize","gui","GUI","ptFolder","value","animate","applyMaterialInfo","info"],"mappings":"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"}