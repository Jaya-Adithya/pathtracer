import"./modulepreload-polyfill-B5Qt9EMX.js";import{V as E,t as x,au as F,av as R,aw as T,ay as G,f as W,d as A,az as B}from"./MaterialBase-D0apYRZI.js";import{G as k}from"./GLTFLoader-CZoURFu4.js";import{D as H}from"./DRACOLoader-Y9SiWgF2.js";import{O}from"./OrbitControls-QPbjf6RX.js";import{H as V}from"./HDRLoader-QyionP9_.js";import{M as _}from"./meshopt_decoder.module-j6OW_3Rk.js";import{g as z}from"./lil-gui.module.min-BH_YJbPT.js";import{g as I}from"./getScaledSettings-nzgggDDj.js";import{L as j}from"./LoaderElement-DklLdAaa.js";import{D as Y,M as v}from"./modelList-BunZDs6G.js";import{P as q}from"./PathTracingRenderer-CqRsglCw.js";import{W as U,G as X}from"./WebGLPathTracer-BkY-ibNS.js";import{B as N}from"./BlurredEnvMapGenerator-DwfiHKYk.js";import{P as K}from"./ParallelMeshBVHWorker-C6VKfx-V.js";import"./BufferGeometryUtils-B2ZswfaJ.js";import"./FogVolumeMaterial-BAhPC4Ul.js";import"./pcg.glsl-D_3-p9wz.js";import"./ggx_functions.glsl-Bslli_qd.js";import"./GenerateMeshBVHWorker-CSNZTU94.js";const J="https://raw.githubusercontent.com/mrdoob/three.js/r150/examples/textures/equirectangular/royal_esplanade_1k.hdr",Q="Path tracing with configurable bokeh and depth of field. Click point in scene to focus.";let t,i,w,e,l,M,h,g=null;const S=new E,b=new x,o={model:Y,bounces:3,renderScale:1/window.devicePixelRatio,filterGlossyFactor:.5,tiles:1,autoFocus:!0,...I()};Z();async function P(a){const n=v[a];if(!n||!n.url)return;g&&(l.remove(g),g=null),h.setPercentage(0);const d=new H;d.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.7/");const p=await new k().setDRACOLoader(d).setMeshoptDecoder(_).loadAsync(n.url);d.dispose();const u=p.scene;n.postProcess&&n.postProcess(u),u.scale.setScalar(.5),u.traverse(c=>{c.material&&(c.material.roughness=.05,c.material.metalness=.05)}),l.add(u),g=u,l.updateMatrixWorld(!0);const f=await t.setSceneAsync(l,e,{onProgress:c=>h.setPercentage(c)});M=f&&f.bvh?f.bvh:null,h.setCredits(n.credit||""),s()}async function Z(){h=new j,h.attach(document.body),i=new F({antialias:!0}),i.toneMapping=R,document.body.appendChild(i.domElement),t=new U(i),t.setBVHWorker(new K),t.tiles.set(o.tiles,o.tiles),e=new q(60,window.innerWidth/window.innerHeight,.025,500),e.position.set(-.262,.5276,-1.1606),e.apertureBlades=6,e.fStop=.6,e.focusDistance=1.1878,b.set(-.5253353217832674,.3031596413506029,.000777794185259223);const a=new X;a.topColor.set(3739424).convertSRGBToLinear(),a.bottomColor.set(1383199).convertSRGBToLinear(),a.update(),l=new T,l.background=a,l.environmentIntensity=.5,w=new O(e,i.domElement),w.target.set(-.182,.147,.06),w.update(),w.addEventListener("change",()=>{o.autoFocus&&(e.focusDistance=e.position.distanceTo(b)-e.near),t.updateCamera()});const[n]=await Promise.all([new V().loadAsync(J)]),d=new N(i),p=d.generate(n,.35);d.dispose(),n.dispose(),l.environment=p;const u=new G(1,10,10),f=new W({emissiveIntensity:10,emissive:16777215});for(let r=0;r<300;r++){const y=new A(u,f);y.scale.setScalar(.075*Math.random()+.03),y.position.randomDirection().multiplyScalar(30+Math.random()*15),l.add(y)}await P(o.model),h.setDescription(Q),s(),L(),window.addEventListener("resize",L),i.domElement.addEventListener("mouseup",ee),i.domElement.addEventListener("mousedown",$);const c=new z;c.add(o,"model",Object.keys(v).sort()).onChange(async r=>{await P(r)});const C=c.addFolder("Path Tracer");C.add(o,"tiles",1,4,1).onChange(r=>{t.tiles.set(r,r)}),C.add(o,"bounces",1,30,1).onChange(s),C.add(o,"renderScale",.1,1).onChange(s);const m=c.addFolder("Camera");m.add(e,"focusDistance",1,100).onChange(s).listen(),m.add(e,"apertureBlades",0,10,1).onChange(function(r){e.apertureBlades=r===0?0:Math.max(r,3),this.updateDisplay(),s()}),m.add(e,"apertureRotation",0,12.5).onChange(s),m.add(e,"anamorphicRatio",.1,10).onChange(s),m.add(e,"bokehSize",0,100).onChange(s).listen(),m.add(e,"fStop",.02,20).onChange(s).listen(),m.add(e,"fov",25,100).onChange(()=>{e.updateProjectionMatrix(),t.updateCamera()}).listen(),m.add(o,"autoFocus"),D()}function $(a){S.set(a.clientX,a.clientY)}function ee(a){if(Math.abs(S.x-a.clientX)+Math.abs(S.y-a.clientY)<2&&M){const d=new B;d.setFromCamera({x:a.clientX/window.innerWidth*2-1,y:-(a.clientY/window.innerHeight)*2+1},e);const p=M.raycastFirst(d.ray);p&&(b.copy(p.point),e.focusDistance=p.distance-e.near,t.updateCamera())}}function L(){i.setSize(window.innerWidth,window.innerHeight),i.setPixelRatio(window.devicePixelRatio),e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),t.updateCamera()}function s(){t.filterGlossyFactor=o.filterGlossyFactor,t.bounces=o.bounces,t.renderScale=o.renderScale,t.updateCamera(),t.reset()}function D(){requestAnimationFrame(D),t.renderSample(),h.setSamples(t.samples,t.isCompiling)}
//# sourceMappingURL=depthOfField-kxPziq0k.js.map
