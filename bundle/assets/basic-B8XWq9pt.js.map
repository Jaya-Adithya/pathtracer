{"version":3,"file":"basic-B8XWq9pt.js","sources":["../../example/basic.js"],"sourcesContent":["import {\r\n\tACESFilmicToneMapping,\r\n\tScene,\r\n\tEquirectangularReflectionMapping,\r\n\tWebGLRenderer,\r\n\tPerspectiveCamera,\r\n\tCubeTextureLoader,\r\n} from 'three';\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\r\nimport { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader.js';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\r\nimport { HDRLoader } from 'three/examples/jsm/loaders/HDRLoader.js';\r\nimport { ParallelMeshBVHWorker } from 'three-mesh-bvh/worker';\r\nimport { getScaledSettings } from './utils/getScaledSettings.js';\r\nimport { LoaderElement } from './utils/LoaderElement.js';\r\nimport { MODEL_LIST, DEFAULT_MODEL_KEY } from './utils/modelList.js';\r\nimport { WebGLPathTracer } from '..';\r\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\r\n\r\nconst ENV_URL = 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/chinese_garden_1k.hdr';\r\nconst DESCRIPTION = 'Simple path tracing example scene setup with background blur.';\r\n\r\nlet pathTracer, renderer, controls;\r\nlet camera, scene, currentModel = null;\r\nlet loader;\r\nconst params = { model: DEFAULT_MODEL_KEY };\r\n\r\ninit();\r\n\r\nasync function init() {\r\n\r\n\tconst { tiles, renderScale } = getScaledSettings();\r\n\r\n\tloader = new LoaderElement();\r\n\tloader.attach( document.body );\r\n\r\n\t// renderer\r\n\trenderer = new WebGLRenderer( { antialias: true } );\r\n\trenderer.toneMapping = ACESFilmicToneMapping;\r\n\tdocument.body.appendChild( renderer.domElement );\r\n\r\n\t// path tracer\r\n\tpathTracer = new WebGLPathTracer( renderer );\r\n\tpathTracer.filterGlossyFactor = 0.5;\r\n\tpathTracer.renderScale = renderScale;\r\n\tpathTracer.tiles.set( tiles, tiles );\r\n\tpathTracer.setBVHWorker( new ParallelMeshBVHWorker() );\r\n\r\n\t// camera\r\n\tcamera = new PerspectiveCamera( 75, 1, 0.025, 500 );\r\n\tcamera.position.set( 8, 9, 24 );\r\n\r\n\t// scene\r\n\tscene = new Scene();\r\n\tscene.backgroundBlurriness = 0.05;\r\n\r\n\t// controls\r\n\tcontrols = new OrbitControls( camera, renderer.domElement );\r\n\tcontrols.target.y = 10;\r\n\tcontrols.addEventListener( 'change', () => pathTracer.updateCamera() );\r\n\tcontrols.update();\r\n\r\n\t// load the appropriate env\r\n\tlet envPromise;\r\n\tif ( window.location.hash.includes( 'cube' ) ) {\r\n\r\n\t\tconst path = 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/cube/SwedishRoyalCastle/';\r\n\t\tconst format = '.jpg';\r\n\t\tconst envUrls = [\r\n\t\t\tpath + 'px' + format, path + 'nx' + format,\r\n\t\t\tpath + 'py' + format, path + 'ny' + format,\r\n\t\t\tpath + 'pz' + format, path + 'nz' + format\r\n\t\t];\r\n\t\tenvPromise = new CubeTextureLoader().loadAsync( envUrls );\r\n\r\n\t\tscene.environmentIntensity = 5;\r\n\t\tscene.backgroundIntensity = 5;\r\n\r\n\t} else {\r\n\r\n\t\tenvPromise = new HDRLoader().loadAsync( ENV_URL ).then( tex => {\r\n\r\n\t\t\ttex.mapping = EquirectangularReflectionMapping;\r\n\t\t\treturn tex;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tconst envTexture = await envPromise;\r\n\tscene.background = envTexture;\r\n\tscene.environment = envTexture;\r\n\r\n\tasync function loadAndSetModel( modelKey ) {\r\n\r\n\t\tconst entry = MODEL_LIST[ modelKey ];\r\n\t\tif ( ! entry || ! entry.url ) return;\r\n\t\tif ( currentModel ) scene.remove( currentModel );\r\n\t\tloader.setPercentage( 0 );\r\n\t\tconst dracoLoader = new DRACOLoader();\r\n\t\tdracoLoader.setDecoderPath( 'https://www.gstatic.com/draco/versioned/decoders/1.5.7/' );\r\n\t\tconst gltf = await new GLTFLoader().setDRACOLoader( dracoLoader ).loadAsync( entry.url );\r\n\t\tdracoLoader.dispose();\r\n\t\tconst model = gltf.scene;\r\n\t\tif ( entry.postProcess ) entry.postProcess( model );\r\n\t\tscene.add( model );\r\n\t\tcurrentModel = model;\r\n\t\tscene.updateMatrixWorld( true );\r\n\t\tawait pathTracer.setSceneAsync( scene, camera, { onProgress: v => loader.setPercentage( v ) } );\r\n\t\tloader.setCredits( entry.credit || '' );\r\n\t}\r\n\r\n\tawait loadAndSetModel( params.model );\r\n\r\n\tloader.setDescription( DESCRIPTION );\r\n\twindow.addEventListener( 'resize', onResize );\r\n\r\n\tconst gui = new GUI();\r\n\tgui.add( params, 'model', Object.keys( MODEL_LIST ).sort() ).onChange( async ( v ) => { await loadAndSetModel( v ); } );\r\n\r\n\tonResize();\r\n\tanimate();\r\n\r\n}\r\n\r\nfunction onResize() {\r\n\r\n\t// update resolution\r\n\trenderer.setSize( window.innerWidth, window.innerHeight );\r\n\trenderer.setPixelRatio( window.devicePixelRatio );\r\n\r\n\tcamera.aspect = window.innerWidth / window.innerHeight;\r\n\tcamera.updateProjectionMatrix();\r\n\r\n\t// update camera\r\n\tpathTracer.updateCamera();\r\n\r\n}\r\n\r\nfunction animate() {\r\n\r\n\trequestAnimationFrame( animate );\r\n\r\n\tpathTracer.renderSample();\r\n\r\n\tloader.setSamples( pathTracer.samples, pathTracer.isCompiling );\r\n\r\n}\r\n"],"names":["ENV_URL","DESCRIPTION","pathTracer","renderer","controls","camera","scene","currentModel","loader","params","DEFAULT_MODEL_KEY","init","tiles","renderScale","getScaledSettings","LoaderElement","WebGLRenderer","ACESFilmicToneMapping","WebGLPathTracer","ParallelMeshBVHWorker","PerspectiveCamera","Scene","OrbitControls","envPromise","path","format","envUrls","CubeTextureLoader","HDRLoader","tex","EquirectangularReflectionMapping","envTexture","loadAndSetModel","modelKey","entry","MODEL_LIST","dracoLoader","DRACOLoader","gltf","GLTFLoader","model","v","onResize","GUI","animate"],"mappings":"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"}