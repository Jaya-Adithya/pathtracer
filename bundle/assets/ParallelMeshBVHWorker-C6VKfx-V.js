import{k as W,B as P}from"./MaterialBase-D0apYRZI.js";import{i as u,e as w,M as b,c as l}from"./pcg.glsl-D_3-p9wz.js";import{G as g,W as M}from"./GenerateMeshBVHWorker-CSNZTU94.js";const d=typeof navigator<"u"?navigator.hardwareConcurrency:4;class H extends M{constructor(){const r=new Worker(new URL(""+new URL("parallelMeshBVH.worker-CqJ_T1F0.js",import.meta.url).href,import.meta.url),{type:"module"});if(super(r),this.name="ParallelMeshBVHWorker",this.maxWorkerCount=Math.max(d,4),!u())throw new Error("ParallelMeshBVHWorker: Shared Array Buffers are not supported.")}runTask(r,e,s={}){return new Promise((B,t)=>{if(s.indirect||w(e,s),e.getAttribute("position").isInterleavedBufferAttribute||e.index&&e.index.isInterleavedBufferAttribute)throw new Error("ParallelMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.");r.onerror=o=>{t(new Error(`ParallelMeshBVHWorker: ${o.message}`))},r.onmessage=o=>{const{data:n}=o;if(n.error)t(new Error(n.error)),r.onmessage=null;else if(n.serialized){const{serialized:a,position:c}=n,i=b.deserialize(a,e,{setIndex:!1}),p={setBoundingBox:!0,...s};if(e.attributes.position.array=c,a.index)if(e.index)e.index.array=a.index;else{const k=new W(a.index,1,!1);e.setIndex(k)}p.setBoundingBox&&(e.boundingBox=i.getBoundingBox(new P)),s.onProgress&&s.onProgress(n.progress),B(i),r.onmessage=null}else s.onProgress&&s.onProgress(n.progress)};const h=e.index?e.index.array:null,x=e.attributes.position.array;r.postMessage({operation:"BUILD_BVH",maxWorkerCount:this.maxWorkerCount,index:l(h,SharedArrayBuffer),position:l(x,SharedArrayBuffer),options:{...s,onProgress:null,includedProgressCallback:!!s.onProgress,groups:[...e.groups]}})})}}class C{constructor(){if(u())return new H;{console.warn("ParallelMeshBVHWorker: SharedArrayBuffers not supported. Falling back to single-threaded GenerateMeshBVHWorker.");const r=new g;return r.maxWorkerCount=d,r}}}export{C as P};
//# sourceMappingURL=ParallelMeshBVHWorker-C6VKfx-V.js.map
