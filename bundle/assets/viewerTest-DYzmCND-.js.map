{"version":3,"file":"viewerTest-DYzmCND-.js","sources":["../../example/viewerTest.js"],"sourcesContent":["import {\r\n\tACESFilmicToneMapping,\r\n\tNoToneMapping,\r\n\tLoadingManager,\r\n\tWebGLRenderer,\r\n\tScene,\r\n\tPerspectiveCamera,\r\n\tEquirectangularReflectionMapping,\r\n\tMathUtils,\r\n\tGroup,\r\n\tSphere,\r\n\tBox3,\r\n} from 'three';\r\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\r\nimport { HDRLoader } from 'three/examples/jsm/loaders/HDRLoader.js';\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\r\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\r\nimport { WebGLPathTracer } from '../src/index.js';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\r\nimport { ParallelMeshBVHWorker } from 'three-mesh-bvh/worker';\r\nimport { LoaderElement } from './utils/LoaderElement.js';\r\n\r\nconst CONFIG_URL = 'https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/config.json';\r\nconst BASE_URL = 'https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/config/';\r\n\r\nconst urlParams = new URLSearchParams( window.location.search );\r\nconst maxSamples = parseInt( urlParams.get( 'samples' ) ) || - 1;\r\nconst hideUI = urlParams.get( 'hideUI' ) === 'true';\r\nconst tiles = parseInt( urlParams.get( 'tiles' ) ) || 2;\r\nconst scale = parseInt( urlParams.get( 'scale' ) ) || 1 / window.devicePixelRatio;\r\n\r\nconst params = {\r\n\r\n\tenable: true,\r\n\tbounces: 10,\r\n\ttransmissiveBounces: 10,\r\n\tpause: false,\r\n\tmultipleImportanceSampling: true,\r\n\tacesToneMapping: true,\r\n\ttiles: tiles,\r\n\tscale: scale,\r\n\r\n\tmodel: '',\r\n\tcheckerboardTransparency: true,\r\n\tdisplayImage: false,\r\n\timageMode: 'overlay',\r\n\timageOpacity: 1.0,\r\n\timageType: 'dspbr-pt',\r\n\r\n};\r\n\r\nlet containerEl, imgEl, loader;\r\nlet gui, model, envMap;\r\nlet pathTracer, renderer, camera, scene, controls;\r\nlet loadingModel = false;\r\nlet delaySamples = 0;\r\nlet modelDatabase;\r\n\r\ninit();\r\n\r\nasync function init() {\r\n\r\n\t// get elements\r\n\tcontainerEl = document.getElementById( 'container' );\r\n\timgEl = document.querySelector( 'img' );\r\n\r\n\tif ( hideUI ) {\r\n\r\n\t\tcontainerEl.style.background = 'transparent';\r\n\t\tdocument.body.style.background = 'transparent';\r\n\r\n\t}\r\n\r\n\tloader = new LoaderElement();\r\n\tif ( ! hideUI ) {\r\n\r\n\t\tloader.attach( document.body );\r\n\r\n\t}\r\n\r\n\t// renderer\r\n\trenderer = new WebGLRenderer( { antialias: true, preserveDrawingBuffer: true } );\r\n\trenderer.physicallyCorrectLights = true;\r\n\trenderer.toneMapping = ACESFilmicToneMapping;\r\n\trenderer.setClearAlpha( 0 );\r\n\tcontainerEl.appendChild( renderer.domElement );\r\n\r\n\t// path tracer\r\n\tpathTracer = new WebGLPathTracer( renderer );\r\n\tpathTracer.filterGlossyFactor = 0.5;\r\n\tpathTracer.tiles.set( params.tiles );\r\n\tpathTracer.setBVHWorker( new ParallelMeshBVHWorker() );\r\n\tpathTracer.multipleImportanceSampling = params.multipleImportanceSampling;\r\n\r\n\t// scene\r\n\tscene = new Scene();\r\n\r\n\t// init camera\r\n\tconst aspect = window.innerWidth / window.innerHeight;\r\n\tcamera = new PerspectiveCamera( 60, aspect, 0.01, 500 );\r\n\tcamera.position.set( - 1, 0.25, 1 );\r\n\r\n\t// controls\r\n\tcontrols = new OrbitControls( camera, containerEl );\r\n\tcontrols.addEventListener( 'change', () => pathTracer.updateCamera() );\r\n\r\n\t// models\r\n\tconst { scenarios } = await fetch( CONFIG_URL ).then( res => res.json() );\r\n\tmodelDatabase = {};\r\n\tscenarios.forEach( s => modelDatabase[ s.name ] = s );\r\n\r\n\twindow.addEventListener( 'hashchange', onHashChange );\r\n\tonHashChange();\r\n\r\n\tanimate();\r\n\r\n}\r\n\r\nfunction animate() {\r\n\r\n\trequestAnimationFrame( animate );\r\n\r\n\t// if rendering has completed then don't render\r\n\tif ( pathTracer.samples >= maxSamples && maxSamples !== - 1 ) {\r\n\r\n\t\treturn;\r\n\r\n\t}\r\n\r\n\timgEl.style.display = ! params.displayImage ? 'none' : 'inline-block';\r\n\timgEl.style.opacity = params.imageMode === 'side-by-side' ? 1.0 : params.imageOpacity;\r\n\timgEl.style.position = params.imageMode === 'side-by-side' ? 'initial' : 'absolute';\r\n\timgEl.style.width = renderer.domElement.style.width;\r\n\timgEl.style.height = renderer.domElement.style.height;\r\n\r\n\tif ( loadingModel ) {\r\n\r\n\t\treturn;\r\n\r\n\t}\r\n\r\n\t// TODO: use a delay field from WebGLPathTracer\r\n\tif ( params.enable && delaySamples === 0 ) {\r\n\r\n\t\tpathTracer.enablePathTracing = params.enable;\r\n\t\tpathTracer.pausePathTracing = params.pause || pathTracer.samples > maxSamples && maxSamples !== - 1;\r\n\r\n\t\tpathTracer.renderSample();\r\n\r\n\t} else if ( delaySamples > 0 || ! params.enable ) {\r\n\r\n\t\tdelaySamples = Math.max( delaySamples - 1, 0 );\r\n\t\trenderer.render( scene, camera );\r\n\r\n\t}\r\n\r\n\t// rendering has completed\r\n\tif ( pathTracer.samples >= maxSamples && maxSamples !== - 1 ) {\r\n\r\n\t\trequestAnimationFrame( () => window.dispatchEvent( new Event( 'render-complete' ) ) );\r\n\r\n\t}\r\n\r\n\tloader.setSamples( pathTracer.samples, pathTracer.isCompiling );\r\n\r\n}\r\n\r\nfunction onHashChange() {\r\n\r\n\tparams.model = Object.keys( modelDatabase )[ 0 ];\r\n\tif ( window.location.hash ) {\r\n\r\n\t\tconst modelName = window.location.hash.substring( 1 ).replaceAll( '%20', ' ' );\r\n\t\tif ( modelName in modelDatabase ) {\r\n\r\n\t\t\tparams.model = modelName;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tupdateModel();\r\n\r\n}\r\n\r\nfunction onParamsChange() {\r\n\r\n\tif ( pathTracer.tiles !== 1.0 ) {\r\n\r\n\t\tdelaySamples = 1;\r\n\r\n\t}\r\n\r\n\tif ( params.checkerboardTransparency ) {\r\n\r\n\t\tcontainerEl.classList.add( 'checkerboard' );\r\n\r\n\t} else {\r\n\r\n\t\tcontainerEl.classList.remove( 'checkerboard' );\r\n\r\n\t}\r\n\r\n\tpathTracer.multipleImportanceSampling = params.multipleImportanceSampling;\r\n\tpathTracer.bounces = params.bounces;\r\n\tpathTracer.transmissiveBounces = params.transmissiveBounces;\r\n\tpathTracer.renderScale = params.scale;\r\n\r\n\tconst model = modelDatabase[ params.model ];\r\n\tscene.background = model && model.renderSkybox ? scene.environment : null;\r\n\tpathTracer.updateEnvironment();\r\n\r\n}\r\n\r\nfunction buildGui() {\r\n\r\n\tif ( hideUI ) {\r\n\r\n\t\treturn;\r\n\r\n\t}\r\n\r\n\tif ( gui ) {\r\n\r\n\t\tgui.destroy();\r\n\r\n\t}\r\n\r\n\tgui = new GUI();\r\n\tgui.add( params, 'model', Object.keys( modelDatabase ) ).onChange( v => {\r\n\r\n\t\twindow.location.hash = v;\r\n\r\n\t} );\r\n\r\n\tconst pathTracingFolder = gui.addFolder( 'Path Tracer' );\r\n\tpathTracingFolder.add( params, 'enable' );\r\n\tpathTracingFolder.add( params, 'pause' );\r\n\tpathTracingFolder.add( params, 'scale', 0.1, 1 ).onChange( onParamsChange );\r\n\tpathTracingFolder.add( params, 'multipleImportanceSampling' ).onChange( onParamsChange );\r\n\tpathTracingFolder.add( params, 'acesToneMapping' ).onChange( v => {\r\n\r\n\t\trenderer.toneMapping = v ? ACESFilmicToneMapping : NoToneMapping;\r\n\r\n\t} );\r\n\tpathTracingFolder.add( params, 'tiles', 1, 10, 1 ).onChange( v => {\r\n\r\n\t\tpathTracer.tiles.set( v, v );\r\n\r\n\t} );\r\n\tpathTracingFolder.add( params, 'bounces', 1, 20, 1 ).onChange( onParamsChange );\r\n\tpathTracingFolder.add( params, 'transmissiveBounces', 1, 20, 1 ).onChange( onParamsChange );\r\n\r\n\tconst comparisonFolder = gui.addFolder( 'Comparison' );\r\n\tcomparisonFolder.add( params, 'displayImage' );\r\n\tcomparisonFolder.add( params, 'imageMode', [ 'overlay', 'side-by-side' ] );\r\n\tcomparisonFolder.add( params, 'imageType', [\r\n\t\t'dspbr-pt',\r\n\t\t'filament',\r\n\t\t'babylon',\r\n\t\t'gltf-sample-viewer',\r\n\t\t'model-viewer',\r\n\t\t'rhodonite',\r\n\t\t'stellar'\r\n\t] ).onChange( updateImage );\r\n\tcomparisonFolder.add( params, 'imageOpacity', 0, 1.0 );\r\n\tcomparisonFolder.add( params, 'checkerboardTransparency' ).onChange( onParamsChange );\r\n\r\n}\r\n\r\nasync function updateModel() {\r\n\r\n\t// dispose of a gui\r\n\tif ( gui ) {\r\n\r\n\t\tcontainerEl.classList.remove( 'checkerboard' );\r\n\t\tgui.destroy();\r\n\t\tgui = null;\r\n\r\n\t}\r\n\r\n\t// dispose of everything\r\n\tif ( model ) {\r\n\r\n\t\tmodel.traverse( c => {\r\n\r\n\t\t\tif ( c.material ) {\r\n\r\n\t\t\t\tconst material = c.material;\r\n\t\t\t\tfor ( const key in material ) {\r\n\r\n\t\t\t\t\tif ( material[ key ] && material[ key ].isTexture ) {\r\n\r\n\t\t\t\t\t\tmaterial[ key ].dispose();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tscene.remove( model );\r\n\r\n\t}\r\n\r\n\t// dispose of the background\r\n\tif ( envMap ) {\r\n\r\n\t\tenvMap.dispose();\r\n\r\n\t}\r\n\r\n\tconst modelInfo = modelDatabase[ params.model ];\r\n\tconst {\r\n\t\tverticalFoV = 45,\r\n\t\tlighting = '../../../shared-assets/environments/lightroom_14b.hdr',\r\n\t} = modelInfo;\r\n\r\n\tlet {\r\n\t\torbit = {},\r\n\t\ttarget = {},\r\n\t\tdimensions = {},\r\n\t} = modelInfo;\r\n\r\n\torbit = { theta: 0, phi: 90, radius: 1, ...orbit };\r\n\ttarget = { x: 0, y: 0, z: 0, ...target };\r\n\tdimensions = { width: 768, height: 768, ...dimensions };\r\n\r\n\t// add a minimal radius so the camera orientation is correct when radius is 0\r\n\torbit.radius = Math.max( orbit.radius, 1e-5 );\r\n\r\n\tloadingModel = true;\r\n\tcontainerEl.style.display = 'none';\r\n\r\n\t// load assets\r\n\tconst envUrl = new URL( lighting, BASE_URL ).toString();\r\n\tconst modelUrl = new URL( modelInfo.model, BASE_URL )\r\n\t\t.toString()\r\n\t\t.replace( /.*?glTF-Sample-Assets/, 'https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Assets/main' );\r\n\r\n\tconst manager = new LoadingManager();\r\n\tconst [ envTexture, gltf ] = await Promise.all( [\r\n\t\tnew HDRLoader( manager ).loadAsync( envUrl ),\r\n\t\tnew GLTFLoader( manager ).setMeshoptDecoder( MeshoptDecoder )\r\n\t\t\t.loadAsync( modelUrl, progress => {\r\n\r\n\t\t\t\tif ( progress.total !== 0 && progress.total >= progress.loaded ) {\r\n\r\n\t\t\t\t\tloader.setPercentage( 0.5 * progress.loaded / progress.total );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} ),\r\n\t\tnew Promise( resolve => manager.onLoad = resolve ),\r\n\t] );\r\n\r\n\tenvMap = envTexture;\r\n\tenvMap.mapping = EquirectangularReflectionMapping;\r\n\tscene.environment = envMap;\r\n\r\n\tmodel = gltf.scene;\r\n\r\n\tconst targetsToDisconnect = [];\r\n\tmodel.traverse( c => {\r\n\r\n\t\tif ( c.isLight && c.target ) {\r\n\r\n\t\t\ttargetsToDisconnect.push( c.target );\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\r\n\t// disconnect all light targets from parents because that's what happens after a clone which\r\n\t// is needed to match the model viewer setup\r\n\ttargetsToDisconnect.forEach( t => t.removeFromParent() );\r\n\r\n\t// add a parent group to process the parent offset\r\n\tconst targetGroup = new Group();\r\n\ttargetGroup.position.set( - target.x, - target.y, - target.z );\r\n\ttargetGroup.add( model );\r\n\r\n\t// replace the target group TODO\r\n\tmodel = targetGroup;\r\n\tmodel.updateMatrixWorld( true );\r\n\tscene.add( model );\r\n\r\n\tconst box = new Box3();\r\n\tconst sphere = new Sphere();\r\n\tbox.setFromObject( model );\r\n\tbox.getBoundingSphere( sphere );\r\n\r\n\t// mirror the model-viewer near / far planes\r\n\tconst radius = Math.max( orbit.radius, sphere.radius );\r\n\tcamera.near = 2 * radius / 1000;\r\n\tcamera.far = 2 * radius;\r\n\tcamera.updateProjectionMatrix();\r\n\tcamera.position.setFromSphericalCoords( orbit.radius, MathUtils.DEG2RAD * orbit.phi, MathUtils.DEG2RAD * orbit.theta );\r\n\r\n\t// initialize the canvas size\r\n\tconst { width, height } = dimensions;\r\n\trenderer.setSize( width, height );\r\n\trenderer.setPixelRatio( window.devicePixelRatio );\r\n\tcamera.aspect = width / height;\r\n\tcamera.fov = verticalFoV;\r\n\tcamera.updateProjectionMatrix();\r\n\tcontrols.update();\r\n\r\n\tawait pathTracer.setSceneAsync( scene, camera, {\r\n\t\tonProgress: v => {\r\n\r\n\t\t\tloader.setPercentage( 0.5 + 0.5 * v );\r\n\r\n\t\t}\r\n\t} );\r\n\r\n\tloader.setCredits( modelInfo.credit || '' );\r\n\tcontainerEl.style.display = 'flex';\r\n\tloadingModel = false;\r\n\r\n\tonParamsChange();\r\n\tbuildGui();\r\n\tupdateImage();\r\n\r\n}\r\n\r\nfunction updateImage() {\r\n\r\n\timgEl.src = `https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/goldens/${ params.model }/${ params.imageType }-golden.png`;\r\n\r\n}\r\n"],"names":["CONFIG_URL","BASE_URL","urlParams","maxSamples","hideUI","tiles","scale","params","containerEl","imgEl","loader","gui","model","envMap","pathTracer","renderer","camera","scene","controls","loadingModel","delaySamples","modelDatabase","init","LoaderElement","WebGLRenderer","ACESFilmicToneMapping","WebGLPathTracer","ParallelMeshBVHWorker","Scene","aspect","PerspectiveCamera","OrbitControls","scenarios","res","s","onHashChange","animate","modelName","updateModel","onParamsChange","buildGui","GUI","v","pathTracingFolder","NoToneMapping","comparisonFolder","updateImage","c","material","key","modelInfo","verticalFoV","lighting","orbit","target","dimensions","envUrl","modelUrl","manager","LoadingManager","envTexture","gltf","HDRLoader","GLTFLoader","MeshoptDecoder","progress","resolve","EquirectangularReflectionMapping","targetsToDisconnect","t","targetGroup","Group","box","Box3","sphere","Sphere","radius","MathUtils","width","height"],"mappings":"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"}