{"version":3,"file":"areaLight-BHIbaiDq.js","sources":["../../src/objects/ShapedAreaLight.js","../../example/areaLight.js"],"sourcesContent":["import { RectAreaLight } from 'three';\r\n\r\nexport class ShapedAreaLight extends RectAreaLight {\r\n\r\n\tconstructor( ...args ) {\r\n\r\n\t\tsuper( ...args );\r\n\t\tthis.isCircular = false;\r\n\r\n\t}\r\n\r\n\tcopy( source, recursive ) {\r\n\r\n\t\tsuper.copy( source, recursive );\r\n\r\n\t\tthis.isCircular = source.isCircular;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n","import {\r\n\tACESFilmicToneMapping,\r\n\tBox3,\r\n\tColor,\r\n\tCylinderGeometry,\r\n\tEquirectangularReflectionMapping,\r\n\tMesh,\r\n\tMeshStandardMaterial,\r\n\tPerspectiveCamera,\r\n\tScene,\r\n\tWebGLRenderer,\r\n} from 'three';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\r\nimport { ShapedAreaLight, WebGLPathTracer } from '../src/index.js';\r\nimport { HDRLoader } from 'three/examples/jsm/loaders/HDRLoader.js';\r\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\r\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\r\nimport { ParallelMeshBVHWorker } from 'three-mesh-bvh/worker';\r\nimport { getScaledSettings } from './utils/getScaledSettings.js';\r\nimport { LoaderElement } from './utils/LoaderElement.js';\r\n\r\nconst ENV_URL = 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/leadenhall_market_1k.hdr';\r\nconst MODEL_URL = 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/mercury-about-to-kill-argos/scene.glb';\r\nconst CREDITS = 'Model courtesy of Virtual Museums of MaÅ‚opolska';\r\n\r\nlet pathTracer, renderer, controls, areaLight, scene, camera;\r\nlet loader;\r\n\r\nconst params = {\r\n\r\n\t// area light settings\r\n\tenabled: true,\r\n\tisCircular: false,\r\n\tintensity: 2,\r\n\tcolor: '#ffffff',\r\n\twidth: 1,\r\n\theight: 1,\r\n\r\n\t// path tracer settings\r\n\tbounces: 5,\r\n\trenderScale: 1 / window.devicePixelRatio,\r\n\tfilterGlossyFactor: 0.5,\r\n\ttiles: 1,\r\n\tmultipleImportanceSampling: true,\r\n\r\n\t...getScaledSettings(),\r\n\r\n};\r\n\r\ninit();\r\n\r\nasync function init() {\r\n\r\n\tloader = new LoaderElement();\r\n\tloader.attach( document.body );\r\n\r\n\t// renderer\r\n\trenderer = new WebGLRenderer( { antialias: true } );\r\n\trenderer.toneMapping = ACESFilmicToneMapping;\r\n\tdocument.body.appendChild( renderer.domElement );\r\n\r\n\t// path tracer\r\n\tpathTracer = new WebGLPathTracer( renderer );\r\n\tpathTracer.tiles.set( params.tiles, params.tiles );\r\n\tpathTracer.setBVHWorker( new ParallelMeshBVHWorker() );\r\n\r\n\t// camera\r\n\tcamera = new PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.025, 500 );\r\n\tcamera.position.set( 0.0, 0.6, 2.65 );\r\n\r\n\t// controls\r\n\tcontrols = new OrbitControls( camera, renderer.domElement );\r\n\tcontrols.target.set( 0, 0.33, - 0.08 );\r\n\tcontrols.addEventListener( 'change', () => pathTracer.updateCamera() );\r\n\tcontrols.update();\r\n\r\n\t// init scene\r\n\tscene = new Scene();\r\n\tscene.environmentIntensity = 0.03;\r\n\tscene.backgroundIntensity = 0.03;\r\n\r\n\t// load the assets\r\n\tconst [ envTexture, gltf ] = await Promise.all( [\r\n\t\tnew HDRLoader().loadAsync( ENV_URL ),\r\n\t\tnew GLTFLoader().setMeshoptDecoder( MeshoptDecoder ).loadAsync( MODEL_URL ),\r\n\t] );\r\n\r\n\t// update the env map\r\n\tenvTexture.mapping = EquirectangularReflectionMapping;\r\n\tscene.background = envTexture;\r\n\tscene.environment = envTexture;\r\n\r\n\t// position the model\r\n\tconst box = new Box3();\r\n\tgltf.scene.traverse( c => {\r\n\r\n\t\tif ( c.material ) c.material.map = null;\r\n\r\n\t} );\r\n\r\n\tgltf.scene.scale.setScalar( 0.01 );\r\n\tgltf.scene.position.x = 0.05;\r\n\tgltf.scene.updateMatrixWorld( true );\r\n\tbox.setFromObject( gltf.scene );\r\n\tgltf.scene.position.y -= box.min.y;\r\n\tscene.add( gltf.scene );\r\n\r\n\t// set the floor\r\n\tconst floorGeom = new CylinderGeometry( 3.5, 3.5, 0.05, 60 );\r\n\tconst floorMat = new MeshStandardMaterial( { color: new Color( 0x999999 ), metalness: 0.2, roughness: 0.02 } );\r\n\tconst floor = new Mesh( floorGeom, floorMat );\r\n\tfloor.position.y = - 0.025;\r\n\tscene.add( floor );\r\n\r\n\t// initialize lights\r\n\tareaLight = new ShapedAreaLight( new Color( 0xffffff ), 5.0, 1.0, 1.0 );\r\n\tareaLight.position.x = 1.5;\r\n\tareaLight.position.y = 1.0;\r\n\tareaLight.position.z = - 0.5;\r\n\tareaLight.rotateZ( - Math.PI / 4 );\r\n\tareaLight.rotateX( - Math.PI / 2 );\r\n\tareaLight.isCircular = false;\r\n\tscene.add( areaLight );\r\n\r\n\tconst redLight = new ShapedAreaLight( new Color( 0xff0000 ), 15.0, 1.25, 2.75 );\r\n\tredLight.position.y = 1.25;\r\n\tredLight.position.z = - 1.5;\r\n\tredLight.rotateX( Math.PI );\r\n\tredLight.isCircular = false;\r\n\tscene.add( redLight );\r\n\r\n\t// initialize scene\r\n\tawait pathTracer.setSceneAsync( scene, camera, {\r\n\t\tonProgress: v => {\r\n\r\n\t\t\tloader.setPercentage( v );\r\n\r\n\t\t}\r\n\t} );\r\n\r\n\tloader.setCredits( CREDITS );\r\n\r\n\t// gui\r\n\tconst gui = new GUI();\r\n\tconst ptFolder = gui.addFolder( 'Path Tracer' );\r\n\tptFolder.add( params, 'tiles', 1, 4, 1 ).onChange( value => {\r\n\r\n\t\tpathTracer.tiles.set( value, value );\r\n\r\n\t} );\r\n\tptFolder.add( params, 'filterGlossyFactor', 0, 1 ).onChange( onParamsChange );\r\n\tptFolder.add( params, 'bounces', 1, 15, 1 ).onChange( onParamsChange );\r\n\tptFolder.add( params, 'renderScale', 0.1, 1 ).onChange( onParamsChange );\r\n\tptFolder.add( params, 'multipleImportanceSampling' ).onChange( onParamsChange );\r\n\tptFolder.close();\r\n\r\n\tconst areaLightFolder = gui.addFolder( 'Area Light' );\r\n\tareaLightFolder.add( params, 'enabled' ).name( 'enable' ).onChange( onParamsChange );\r\n\tareaLightFolder.add( params, 'isCircular' ).name( 'isCircular' ).onChange( onParamsChange );\r\n\tareaLightFolder.add( params, 'intensity', 0, 200 ).name( 'intensity' ).onChange( onParamsChange );\r\n\tareaLightFolder.addColor( params, 'color' ).name( 'color' ).onChange( onParamsChange );\r\n\tareaLightFolder.add( params, 'width', 0, 5 ).name( 'width' ).onChange( onParamsChange );\r\n\tareaLightFolder.add( params, 'height', 0, 5 ).name( 'height' ).onChange( onParamsChange );\r\n\r\n\tonParamsChange();\r\n\tonResize();\r\n\twindow.addEventListener( 'resize', onResize );\r\n\r\n\tanimate();\r\n\r\n}\r\n\r\nfunction onParamsChange() {\r\n\r\n\tareaLight.isCircular = params.isCircular;\r\n\tareaLight.intensity = params.intensity;\r\n\tareaLight.width = params.width;\r\n\tareaLight.height = params.height;\r\n\tareaLight.color.set( params.color ).convertSRGBToLinear();\r\n\tareaLight.visible = params.enabled;\r\n\r\n\tpathTracer.filterGlossyFactor = params.filterGlossyFactor;\r\n\tpathTracer.bounces = params.bounces;\r\n\tpathTracer.renderScale = params.renderScale;\r\n\tpathTracer.multipleImportanceSampling = params.multipleImportanceSampling;\r\n\r\n\tpathTracer.updateLights();\r\n\r\n}\r\n\r\nfunction onResize() {\r\n\r\n\trenderer.setSize( window.innerWidth, window.innerHeight );\r\n\trenderer.setPixelRatio( window.devicePixelRatio );\r\n\tcamera.aspect = window.innerWidth / window.innerHeight;\r\n\tcamera.updateProjectionMatrix();\r\n\r\n\tpathTracer.updateCamera();\r\n\r\n}\r\n\r\nfunction animate() {\r\n\r\n\trequestAnimationFrame( animate );\r\n\r\n\tpathTracer.renderSample();\r\n\r\n\tloader.setSamples( pathTracer.samples, pathTracer.isCompiling );\r\n\r\n}\r\n"],"names":["ShapedAreaLight","RectAreaLight","args","source","recursive","ENV_URL","MODEL_URL","CREDITS","pathTracer","renderer","controls","areaLight","scene","camera","loader","params","getScaledSettings","init","LoaderElement","WebGLRenderer","ACESFilmicToneMapping","WebGLPathTracer","ParallelMeshBVHWorker","PerspectiveCamera","OrbitControls","Scene","envTexture","gltf","HDRLoader","GLTFLoader","MeshoptDecoder","EquirectangularReflectionMapping","box","Box3","c","floorGeom","CylinderGeometry","floorMat","MeshStandardMaterial","Color","floor","Mesh","redLight","v","gui","GUI","ptFolder","value","onParamsChange","areaLightFolder","onResize","animate"],"mappings":"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"}