{"version":3,"file":"fog-C1xTyo3j.js","sources":["../../example/fog.js"],"sourcesContent":["import {\r\n\tACESFilmicToneMapping,\r\n\tScene,\r\n\tBoxGeometry,\r\n\tCylinderGeometry,\r\n\tGroup,\r\n\tMesh,\r\n\tMeshStandardMaterial,\r\n\tWebGLRenderer,\r\n\tColor,\r\n} from 'three';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\r\nimport { PhysicalCamera, PhysicalSpotLight, FogVolumeMaterial, WebGLPathTracer } from '../src/index.js';\r\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\r\nimport { getScaledSettings } from './utils/getScaledSettings.js';\r\nimport { LoaderElement } from './utils/LoaderElement.js';\r\n\r\nlet pathTracer, renderer, controls;\r\nlet camera, scene, fogMaterial, spotLight;\r\nlet loader;\r\n\r\nconst params = {\r\n\r\n\tmultipleImportanceSampling: true,\r\n\ttiles: 2,\r\n\trenderScale: 1 / window.devicePixelRatio,\r\n\r\n\tcolor: '#eeeeee',\r\n\tfog: true,\r\n\tdensity: 0.01,\r\n\tlightIntensity: 500,\r\n\tlightColor: '#ffffff',\r\n\r\n\tbounces: 10,\r\n\r\n\t...getScaledSettings(),\r\n\r\n};\r\n\r\ninit();\r\n\r\nasync function init() {\r\n\r\n\tloader = new LoaderElement();\r\n\tloader.attach( document.body );\r\n\r\n\t// renderer\r\n\trenderer = new WebGLRenderer( { antialias: true } );\r\n\trenderer.toneMapping = ACESFilmicToneMapping;\r\n\tdocument.body.appendChild( renderer.domElement );\r\n\r\n\t// path tracer\r\n\tpathTracer = new WebGLPathTracer( renderer );\r\n\tpathTracer.tiles.set( params.tiles, params.tiles );\r\n\r\n\t// camera\r\n\tconst aspect = window.innerWidth / window.innerHeight;\r\n\tcamera = new PhysicalCamera( 75, aspect, 0.025, 500 );\r\n\tcamera.position.set( 0, 1, 6 );\r\n\r\n\t// controls\r\n\tcontrols = new OrbitControls( camera, renderer.domElement );\r\n\tcontrols.addEventListener( 'change', () => {\r\n\r\n\t\tpathTracer.updateCamera();\r\n\r\n\t} );\r\n\r\n\t// scene\r\n\tscene = new Scene();\r\n\tscene.background = new Color( 0 );\r\n\r\n\tfogMaterial = new FogVolumeMaterial();\r\n\r\n\tconst material = new MeshStandardMaterial( { color: 0x999999, roughness: 1, metalness: 0 } );\r\n\tconst fogMesh = new Mesh( new BoxGeometry( 8, 4.05, 8 ), fogMaterial );\r\n\tconst floor = new Mesh( new CylinderGeometry( 5, 5, 0.1, 40 ), material );\r\n\tfloor.position.y = - 1.1;\r\n\r\n\t// prepare light\r\n\tspotLight = new PhysicalSpotLight();\r\n\tspotLight.position.set( 0, 1, 0 ).multiplyScalar( 3 );\r\n\tspotLight.angle = Math.PI / 4.5;\r\n\tspotLight.decay = 2;\r\n\tspotLight.penumbra = 0.15;\r\n\tspotLight.distance = 0.0;\r\n\tspotLight.intensity = 50.0;\r\n\tspotLight.radius = 0.05;\r\n\r\n\t// prepare slats\r\n\tconst group = new Group();\r\n\tgroup.add( spotLight );\r\n\r\n\tconst TOTAL_SLATS = 10;\r\n\tconst WIDTH = 2.0;\r\n\tconst slat = new Mesh( new BoxGeometry( 0.1, 0.1, 2 ), material );\r\n\tfor ( let i = 0; i < TOTAL_SLATS; i ++ ) {\r\n\r\n\t\tconst s = slat.clone();\r\n\t\ts.position.x = - WIDTH * 0.5 + WIDTH * i / ( TOTAL_SLATS - 1 );\r\n\t\ts.position.y = 2;\r\n\t\tgroup.add( s );\r\n\r\n\t}\r\n\r\n\tscene.add( fogMesh, floor, group );\r\n\tpathTracer.setScene( scene, camera );\r\n\r\n\tloader.setPercentage( 1 );\r\n\tonParamsChange();\r\n\tonResize();\r\n\r\n\twindow.addEventListener( 'resize', onResize );\r\n\r\n\t// gui\r\n\tconst gui = new GUI();\r\n\tconst ptFolder = gui.addFolder( 'Path Tracer' );\r\n\tptFolder.add( params, 'bounces', 1, 20, 1 ).onChange( onParamsChange );\r\n\tptFolder.add( params, 'multipleImportanceSampling' ).onChange( onParamsChange );\r\n\tptFolder.add( params, 'tiles', 1, 4, 1 ).onChange( value => {\r\n\r\n\t\tpathTracer.tiles.set( value, value );\r\n\r\n\t} );\r\n\tptFolder.add( params, 'renderScale', 0.1, 1 ).onChange( onParamsChange );\r\n\r\n\tconst fogFolder = gui.addFolder( 'Fog' );\r\n\tfogFolder.addColor( params, 'color' ).onChange( onParamsChange );\r\n\tfogFolder.add( params, 'density', 0, 1 ).onChange( onParamsChange );\r\n\r\n\tconst lightFolder = gui.addFolder( 'Spot Light' );\r\n\tlightFolder.add( params, 'lightIntensity', 0, 1000 ).onChange( onParamsChange );\r\n\tlightFolder.addColor( params, 'lightColor' ).onChange( onParamsChange );\r\n\r\n\tanimate();\r\n\r\n}\r\n\r\nfunction onParamsChange() {\r\n\r\n\tfogMaterial.color.set( params.color ).convertSRGBToLinear();\r\n\tfogMaterial.density = params.density;\r\n\r\n\tspotLight.intensity = params.lightIntensity;\r\n\tspotLight.color.set( params.lightColor );\r\n\r\n\tpathTracer.multipleImportanceSampling = params.multipleImportanceSampling;\r\n\tpathTracer.bounces = params.bounces;\r\n\tpathTracer.renderScale = params.renderScale;\r\n\r\n\tpathTracer.updateLights();\r\n\tpathTracer.updateMaterials();\r\n\r\n}\r\n\r\nfunction onResize() {\r\n\r\n\trenderer.setSize( window.innerWidth, window.innerHeight );\r\n\trenderer.setPixelRatio( window.devicePixelRatio );\r\n\r\n\tcamera.aspect = window.innerWidth / window.innerHeight;\r\n\tcamera.updateProjectionMatrix();\r\n\r\n\tpathTracer.updateCamera();\r\n\r\n}\r\n\r\nfunction animate() {\r\n\r\n\trequestAnimationFrame( animate );\r\n\r\n\tpathTracer.renderSample();\r\n\r\n\tloader.setSamples( pathTracer.samples, pathTracer.isCompiling );\r\n\r\n}\r\n\r\n\r\n\r\n"],"names":["pathTracer","renderer","controls","camera","scene","fogMaterial","spotLight","loader","params","getScaledSettings","init","LoaderElement","WebGLRenderer","ACESFilmicToneMapping","WebGLPathTracer","aspect","PhysicalCamera","OrbitControls","Scene","Color","FogVolumeMaterial","material","MeshStandardMaterial","fogMesh","Mesh","BoxGeometry","floor","CylinderGeometry","PhysicalSpotLight","group","Group","TOTAL_SLATS","WIDTH","slat","s","onParamsChange","onResize","gui","GUI","ptFolder","value","fogFolder","lightFolder","animate"],"mappings":"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"}