{"version":3,"file":"interior-BqyI0mi8.js","sources":["../../src/objects/EquirectCamera.js","../../example/interior.js"],"sourcesContent":["import { Camera } from 'three';\r\n\r\nexport class EquirectCamera extends Camera {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.isEquirectCamera = true;\r\n\r\n\t}\r\n\r\n}\r\n","import {\r\n\tACESFilmicToneMapping,\r\n\tPerspectiveCamera,\r\n\tBox3,\r\n\tVector3,\r\n\tEquirectangularReflectionMapping,\r\n\tScene,\r\n\tWebGLRenderer,\r\n} from 'three';\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\r\nimport { EquirectCamera, WebGLPathTracer } from '../src/index.js';\r\nimport { HDRLoader } from 'three/examples/jsm/loaders/HDRLoader.js';\r\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\r\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\r\nimport { getScaledSettings } from './utils/getScaledSettings.js';\r\nimport { ParallelMeshBVHWorker } from 'three-mesh-bvh/worker';\r\nimport { LoaderElement } from './utils/LoaderElement.js';\r\n\r\nconst ENV_URL = 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/aristea_wreck_puresky_2k.hdr';\r\nconst MODEL_URL = 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/pathtracing-bathroom/modernbathroom.glb';\r\nconst CREDITS = 'Interior scene by <a href=\"https://twitter.com/charlesforman\">Charles Forman</a>';\r\n\r\nlet pathTracer, renderer, controls, sphericalControls, activeCamera, scene;\r\nlet camera, equirectCamera, loader;\r\n\r\nconst params = {\r\n\r\n\tenvironmentIntensity: 1,\r\n\temissiveIntensity: 5,\r\n\tbounces: 20,\r\n\trenderScale: 1 / window.devicePixelRatio,\r\n\ttiles: 2,\r\n\tprojection: 'Perspective',\r\n\t...getScaledSettings(),\r\n\r\n};\r\n\r\ninit();\r\n\r\nasync function init() {\r\n\r\n\tloader = new LoaderElement();\r\n\tloader.attach( document.body );\r\n\r\n\t// renderer\r\n\trenderer = new WebGLRenderer( { antialias: true } );\r\n\trenderer.toneMapping = ACESFilmicToneMapping;\r\n\tdocument.body.appendChild( renderer.domElement );\r\n\r\n\t// path tracer\r\n\tpathTracer = new WebGLPathTracer( renderer );\r\n\tpathTracer.dynamicLowRes = true;\r\n\tpathTracer.filterGlossyFactor = 0.25;\r\n\tpathTracer.tiles.set( params.tiles, params.tiles );\r\n\tpathTracer.setBVHWorker( new ParallelMeshBVHWorker() );\r\n\r\n\t// camera\r\n\tcamera = new PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.025, 500 );\r\n\tcamera.position.set( 0.4, 0.6, 2.65 );\r\n\r\n\t// Almost, but not quite on top of the control target.\r\n\t// This allows for full rotation without moving the camera very much.\r\n\tequirectCamera = new EquirectCamera();\r\n\tequirectCamera.position.set( - 0.2, 0.33, 0.08 );\r\n\r\n\t// controls\r\n\tcontrols = new OrbitControls( camera, renderer.domElement );\r\n\tcontrols.target.set( - 0.15, 0.33, - 0.08 );\r\n\tcamera.lookAt( controls.target );\r\n\tcontrols.update();\r\n\tcontrols.addEventListener( 'change', () => pathTracer.updateCamera() );\r\n\r\n\tsphericalControls = new OrbitControls( equirectCamera, renderer.domElement );\r\n\tsphericalControls.target.set( - 0.15, 0.33, - 0.08 );\r\n\tequirectCamera.lookAt( sphericalControls.target );\r\n\tsphericalControls.update();\r\n\tsphericalControls.addEventListener( 'change', () => pathTracer.updateCamera() );\r\n\r\n\tscene = new Scene();\r\n\r\n\t// load assets\r\n\tconst [ envTexture, gltf ] = await Promise.all( [\r\n\t\tnew HDRLoader().loadAsync( ENV_URL ),\r\n\t\tnew GLTFLoader().setMeshoptDecoder( MeshoptDecoder ).loadAsync( MODEL_URL ),\r\n\t] );\r\n\r\n\t// set environment\r\n\tenvTexture.mapping = EquirectangularReflectionMapping;\r\n\tscene.background = envTexture;\r\n\tscene.environment = envTexture;\r\n\r\n\t// set scene\r\n\tgltf.scene.traverse( c => {\r\n\r\n\t\tif ( c.material ) {\r\n\r\n\t\t\t// set the thickness so volume rendering is used for transmissive objects.\r\n\t\t\tc.material.thickness = 1.0;\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\r\n\tscene.add( gltf.scene );\r\n\tscene.updateMatrixWorld();\r\n\r\n\tconst box = new Box3();\r\n\tbox.setFromObject( gltf.scene );\r\n\r\n\tconst center = new Vector3();\r\n\tbox.getCenter( center );\r\n\r\n\tgltf.scene.position.addScaledVector( center, - 0.5 );\r\n\r\n\tawait pathTracer.setSceneAsync( scene, camera, {\r\n\t\tonProgress: v => loader.setPercentage( v ),\r\n\t} );\r\n\r\n\tloader.setCredits( CREDITS );\r\n\r\n\tonResize();\r\n\tonParamsChange();\r\n\twindow.addEventListener( 'resize', onResize );\r\n\r\n\t// gui\r\n\tconst gui = new GUI();\r\n\tconst ptFolder = gui.addFolder( 'Path Tracer' );\r\n\tptFolder.add( params, 'tiles', 1, 4, 1 ).onChange( value => {\r\n\r\n\t\tpathTracer.tiles.set( value, value );\r\n\r\n\t} );\r\n\tptFolder.add( params, 'bounces', 1, 30, 1 ).onChange( onParamsChange );\r\n\tptFolder.add( params, 'renderScale', 0.1, 1 ).onChange( onParamsChange );\r\n\r\n\tconst sceneFolder = gui.addFolder( 'Scene' );\r\n\tsceneFolder.add( params, 'projection', [ 'Perspective', 'Equirectangular' ] ).onChange( onParamsChange );\r\n\tsceneFolder.add( params, 'environmentIntensity', 0, 25 ).onChange( onParamsChange );\r\n\tsceneFolder.add( params, 'emissiveIntensity', 0, 50 ).onChange( onParamsChange );\r\n\r\n\tanimate();\r\n\r\n}\r\n\r\nfunction onResize() {\r\n\r\n\trenderer.setSize( window.innerWidth, window.innerHeight );\r\n\trenderer.setPixelRatio( window.devicePixelRatio );\r\n\r\n\tcamera.aspect = window.innerWidth / window.innerHeight;\r\n\tcamera.updateProjectionMatrix();\r\n\r\n\tpathTracer.updateCamera();\r\n\r\n}\r\n\r\nfunction onParamsChange() {\r\n\r\n\tconst projection = params.projection;\r\n\tif ( projection === 'Perspective' ) {\r\n\r\n\t\tactiveCamera = camera;\r\n\r\n\t\tsphericalControls.enabled = false;\r\n\t\tcontrols.enabled = true;\r\n\t\tcontrols.update();\r\n\r\n\t} else if ( projection === 'Equirectangular' ) {\r\n\r\n\t\tactiveCamera = equirectCamera;\r\n\r\n\t\tcontrols.enabled = false;\r\n\t\tsphericalControls.enabled = true;\r\n\t\tsphericalControls.update();\r\n\r\n\t}\r\n\r\n\tscene.traverse( c => {\r\n\r\n\t\tconst material = c.material;\r\n\t\tif ( material ) {\r\n\r\n\t\t\tmaterial.emissiveIntensity = params.emissiveIntensity;\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\r\n\tscene.environmentIntensity = params.environmentIntensity;\r\n\tscene.backgroundIntensity = params.environmentIntensity;\r\n\tpathTracer.bounces = params.bounces;\r\n\tpathTracer.renderScale = params.renderScale;\r\n\r\n\tpathTracer.setScene( scene, activeCamera );\r\n\r\n}\r\n\r\nfunction animate() {\r\n\r\n\trequestAnimationFrame( animate );\r\n\r\n\tpathTracer.renderSample();\r\n\r\n\tloader.setSamples( pathTracer.samples, pathTracer.isCompiling );\r\n\r\n}\r\n\r\n\r\n\r\n\r\n"],"names":["EquirectCamera","Camera","ENV_URL","MODEL_URL","CREDITS","pathTracer","renderer","controls","sphericalControls","activeCamera","scene","camera","equirectCamera","loader","params","getScaledSettings","init","LoaderElement","WebGLRenderer","ACESFilmicToneMapping","WebGLPathTracer","ParallelMeshBVHWorker","PerspectiveCamera","OrbitControls","Scene","envTexture","gltf","HDRLoader","GLTFLoader","MeshoptDecoder","EquirectangularReflectionMapping","c","box","Box3","center","Vector3","v","onResize","onParamsChange","gui","GUI","ptFolder","value","sceneFolder","animate","projection","material"],"mappings":"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"}