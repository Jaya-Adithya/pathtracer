{"version":3,"file":"skinnedMesh-B6Levo1l.js","sources":["../../example/skinnedMesh.js"],"sourcesContent":["import {\r\n\tWebGLRenderer,\r\n\tACESFilmicToneMapping,\r\n\tScene,\r\n\tPerspectiveCamera,\r\n\tClock,\r\n\tAnimationMixer,\r\n\tMesh,\r\n\tPlaneGeometry,\r\n\tMeshStandardMaterial,\r\n} from 'three';\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\r\nimport { BlurredEnvMapGenerator, WebGLPathTracer } from '../src/index.js';\r\nimport { HDRLoader } from 'three/examples/jsm/loaders/HDRLoader.js';\r\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\r\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\r\nimport { generateRadialFloorTexture } from './utils/generateRadialFloorTexture.js';\r\nimport { getScaledSettings } from './utils/getScaledSettings.js';\r\nimport { LoaderElement } from './utils/LoaderElement.js';\r\n\r\nconst ENV_URL = 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/aristea_wreck_puresky_2k.hdr';\r\nconst MORPH_URL = 'https://raw.githubusercontent.com/mrdoob/three.js/r150/examples/models/gltf/RobotExpressive/RobotExpressive.glb';\r\nconst SKINNED_URL = 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/trex/scene.gltf';\r\nconst CREDITS = 'Model by DailyArt on Sketchfab';\r\nconst DESCRIPTION = 'Rendering deformable geometry with path tracing.';\r\n\r\nlet pathTracer, renderer, controls, camera, scene, clock;\r\nlet mixer, mixerAction;\r\nlet loader;\r\nlet counter = 0;\r\nconst params = {\r\n\r\n\tbounces: 5,\r\n\tsamplesPerFrame: 1,\r\n\trenderScale: 1 / window.devicePixelRatio,\r\n\ttiles: 1,\r\n\tautoPause: true,\r\n\tpause: false,\r\n\tcontinuous: false,\r\n\tstableNoise: false,\r\n\t...getScaledSettings(),\r\n\r\n};\r\n\r\ninit();\r\n\r\nasync function init() {\r\n\r\n\tloader = new LoaderElement();\r\n\tloader.setDescription( DESCRIPTION );\r\n\tloader.attach( document.body );\r\n\r\n\t// renderer\r\n\trenderer = new WebGLRenderer( { antialias: true } );\r\n\trenderer.toneMapping = ACESFilmicToneMapping;\r\n\tdocument.body.appendChild( renderer.domElement );\r\n\r\n\t// path tracer\r\n\tpathTracer = new WebGLPathTracer( renderer );\r\n\tpathTracer.multipleImportanceSampling = false;\r\n\tpathTracer.tiles.set( params.tiles, params.tiles );\r\n\tpathTracer.filterGlossyFactor = 0.25;\r\n\tpathTracer.minSamples = 1;\r\n\tpathTracer.renderDelay = 0;\r\n\tpathTracer.fadeDuration = 0;\r\n\r\n\t// scene\r\n\tscene = new Scene();\r\n\r\n\t// camera\r\n\tcamera = new PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.025, 500 );\r\n\tcamera.position.set( 5.5, 3.5, 7.5 );\r\n\r\n\t// controls\r\n\tcontrols = new OrbitControls( camera, renderer.domElement );\r\n\tcamera.lookAt( controls.target );\r\n\tcontrols.addEventListener( 'change', () => pathTracer.updateCamera() );\r\n\tcontrols.update();\r\n\r\n\t// clock\r\n\tclock = new Clock();\r\n\r\n\t// load assets\r\n\tconst modelUrl = window.location.hash === '#morphtarget' ? MORPH_URL : SKINNED_URL;\r\n\tconst [ envTexture, gltf ] = await Promise.all( [\r\n\t\tnew HDRLoader().loadAsync( ENV_URL ),\r\n\t\tnew GLTFLoader().setMeshoptDecoder( MeshoptDecoder ).loadAsync( modelUrl )\r\n\t] );\r\n\r\n\t// update env map\r\n\tconst generator = new BlurredEnvMapGenerator( renderer );\r\n\tconst blurredTex = generator.generate( envTexture, 0.1 );\r\n\tscene.background = blurredTex;\r\n\tscene.environment = blurredTex;\r\n\tgenerator.dispose();\r\n\r\n\t// animations\r\n\tconst animations = gltf.animations;\r\n\tmixer = new AnimationMixer( gltf.scene );\r\n\r\n\tmixerAction = mixer.clipAction( animations[ 0 ] );\r\n\tmixerAction.play();\r\n\tmixerAction.paused = params.pause;\r\n\r\n\t// initialize scene\r\n\tscene.add( gltf.scene );\r\n\r\n\tconst floorTex = generateRadialFloorTexture( 2048 );\r\n\tconst floorPlane = new Mesh(\r\n\t\tnew PlaneGeometry(),\r\n\t\tnew MeshStandardMaterial( {\r\n\t\t\tmap: floorTex,\r\n\t\t\ttransparent: true,\r\n\t\t\tcolor: 0xdddddd,\r\n\t\t\troughness: 0.15,\r\n\t\t\tmetalness: 1.0\r\n\t\t} )\r\n\t);\r\n\tfloorPlane.scale.setScalar( 50 );\r\n\tfloorPlane.rotation.x = - Math.PI / 2;\r\n\tfloorPlane.position.y = 0.075;\r\n\tscene.add( floorPlane );\r\n\r\n\t// initial generation\r\n\tpathTracer.setScene( scene, camera );\r\n\r\n\tloader.setPercentage( 1 );\r\n\tloader.setCredits( CREDITS );\r\n\r\n\tonResize();\r\n\twindow.addEventListener( 'resize', onResize );\r\n\r\n\t// gui\r\n\tconst gui = new GUI();\r\n\tgui.add( params, 'tiles', 1, 4, 1 ).onChange( value => {\r\n\r\n\t\tpathTracer.tiles.set( value, value );\r\n\r\n\t} );\r\n\tgui.add( params, 'bounces', 1, 10, 1 ).onChange( regenerateScene );\r\n\tgui.add( params, 'renderScale', 0.1, 1 ).onChange( v => {\r\n\r\n\t\tpathTracer.renderScale = v;\r\n\t\tpathTracer.reset();\r\n\r\n\t} );\r\n\tgui.add( params, 'autoPause' ).listen();\r\n\tgui.add( params, 'pause' ).onChange( v => {\r\n\r\n\t\tparams.autoPause = false;\r\n\t\tsetPause( v );\r\n\r\n\t} ).listen();\r\n\tgui.add( params, 'continuous' ).onChange( () => {\r\n\r\n\t\tparams.autoPause = false;\r\n\r\n\t} );\r\n\tgui.add( params, 'stableNoise' ).onChange( v => {\r\n\r\n\t\tpathTracer.stableNoise = v;\r\n\r\n\t} );\r\n\r\n\tanimate();\r\n\r\n}\r\n\r\nfunction setPause( v ) {\r\n\r\n\tmixerAction.paused = v;\r\n\tparams.pause = v;\r\n\tif ( v ) {\r\n\r\n\t\tregenerateScene();\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction onResize() {\r\n\r\n\trenderer.setSize( window.innerWidth, window.innerHeight );\r\n\trenderer.setPixelRatio( window.devicePixelRatio );\r\n\r\n\tcamera.aspect = window.innerWidth / window.innerHeight;\r\n\tcamera.updateProjectionMatrix();\r\n\r\n\tpathTracer.updateCamera();\r\n\r\n}\r\n\r\nfunction regenerateScene() {\r\n\r\n\tpathTracer.bounces = params.bounces;\r\n\tpathTracer.setScene( scene, camera );\r\n\r\n}\r\n\r\nfunction animate() {\r\n\r\n\trequestAnimationFrame( animate );\r\n\r\n\t// step the animation forward\r\n\tconst delta = Math.min( clock.getDelta(), 30 * 0.001 );\r\n\tmixer.update( delta );\r\n\r\n\tif ( params.autoPause ) {\r\n\r\n\t\t// auto pause the animation\r\n\t\tcounter += delta;\r\n\t\tif ( ! params.pause && counter >= 2.5 || params.pause && counter >= 5 ) {\r\n\r\n\t\t\tsetPause( ! params.pause );\r\n\t\t\tcounter = 0;\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\tcounter = 0;\r\n\r\n\t}\r\n\r\n\tpathTracer.dynamicLowRes = params.continuous;\r\n\r\n\tif ( ! params.pause && ! params.continuous ) {\r\n\r\n\t\trenderer.render( scene, camera );\r\n\t\tloader.setSamples( 0, pathTracer.isCompiling );\r\n\r\n\t} else {\r\n\r\n\t\t// if we're continuously path tracing then update the scene\r\n\t\tif ( ! params.pause && params.continuous ) {\r\n\r\n\t\t\tregenerateScene();\r\n\r\n\t\t}\r\n\r\n\t\tpathTracer.renderSample();\r\n\t\tloader.setSamples( pathTracer.samples, pathTracer.isCompiling );\r\n\r\n\t}\r\n\r\n}\r\n"],"names":["ENV_URL","MORPH_URL","SKINNED_URL","CREDITS","DESCRIPTION","pathTracer","renderer","controls","camera","scene","clock","mixer","mixerAction","loader","counter","params","getScaledSettings","init","LoaderElement","WebGLRenderer","ACESFilmicToneMapping","WebGLPathTracer","Scene","PerspectiveCamera","OrbitControls","Clock","modelUrl","envTexture","gltf","HDRLoader","GLTFLoader","MeshoptDecoder","generator","BlurredEnvMapGenerator","blurredTex","animations","AnimationMixer","floorTex","generateRadialFloorTexture","floorPlane","Mesh","PlaneGeometry","MeshStandardMaterial","onResize","gui","GUI","value","regenerateScene","v","setPause","animate","delta"],"mappings":"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"}