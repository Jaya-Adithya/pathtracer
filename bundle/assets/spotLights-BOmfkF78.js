import"./modulepreload-polyfill-B5Qt9EMX.js";import{L as Y,H as R,aO as $,D as J,F as X,g as Z,a as ee,aP as te,o as O,a6 as D,au as ae,aQ as ne,av as oe,a5 as re,aw as se,E as ie,d as W,e as le,f as z,aA as de,B as ce}from"./MaterialBase-D0apYRZI.js";import{G as ue}from"./GLTFLoader-CZoURFu4.js";import{D as me}from"./DRACOLoader-Y9SiWgF2.js";import{O as he}from"./OrbitControls-QPbjf6RX.js";import{H as ge}from"./HDRLoader-QyionP9_.js";import{g as pe}from"./lil-gui.module.min-BH_YJbPT.js";import{g as we}from"./getScaledSettings-nzgggDDj.js";import{L as fe}from"./LoaderElement-DklLdAaa.js";import{D as be,M as G}from"./modelList-BunZDs6G.js";import{W as ye}from"./WebGLPathTracer-BkY-ibNS.js";import{P as Ae}from"./ParallelMeshBVHWorker-C6VKfx-V.js";import{P as Se}from"./PhysicalSpotLight-BDJOqa_y.js";import"./BufferGeometryUtils-B2ZswfaJ.js";import"./FogVolumeMaterial-BAhPC4Ul.js";import"./pcg.glsl-D_3-p9wz.js";import"./PathTracingRenderer-CqRsglCw.js";import"./ggx_functions.glsl-Bslli_qd.js";import"./GenerateMeshBVHWorker-CSNZTU94.js";class Ce extends Y{constructor(e){super(e),this.type=R}_getIESValues(e,i){const l=new Array(64800);function F(t,a){let s=0,g=0,w=0,N=0,M=0,E=0;for(let u=0;u<e.numHorAngles-1;++u)if(a<e.horAngles[u+1]||u==e.numHorAngles-2){g=u,w=e.horAngles[u],N=e.horAngles[u+1];break}for(let u=0;u<e.numVerAngles-1;++u)if(t<e.verAngles[u+1]||u==e.numVerAngles-2){s=u,M=e.verAngles[u],E=e.verAngles[u+1];break}const V=N-w,H=E-M;if(H===0)return 0;const k=V===0?0:(a-w)/V,q=(t-M)/H,j=V===0?g:g+1,K=D.lerp(e.candelaValues[g][s],e.candelaValues[j][s],k),Q=D.lerp(e.candelaValues[g][s+1],e.candelaValues[j][s+1],k);return D.lerp(K,Q,q)}const h=e.horAngles[0],r=e.horAngles[e.numHorAngles-1];for(let t=0;t<64800;++t){let a=t%360;const s=Math.floor(t/360);r-h!==0&&(a<h||a>=r)&&(a%=r*2,a>r&&(a=r*2-a)),l[s+a*180]=F(s,a)}let d=null;return i===$?d=Uint8Array.from(l.map(t=>Math.min(t*255,255))):i===R?d=Uint16Array.from(l.map(t=>J.toHalfFloat(t))):i===X?d=Float32Array.from(l):console.error("IESLoader: Unsupported type:",i),d}load(e,i,b,p){const o=new Z(this.manager);o.setResponseType("text"),o.setCrossOrigin(this.crossOrigin),o.setWithCredentials(this.withCredentials),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.load(e,l=>{i(this.parse(l))},b,p)}parse(e){const i=this.type,b=new Fe(e),p=this._getIESValues(b,i),o=new ee(p,180,1,te,i);return o.minFilter=O,o.magFilter=O,o.needsUpdate=!0,o}}function Fe(T){const e=this,i=T.split(`
`);let b=0,p;e.verAngles=[],e.horAngles=[],e.candelaValues=[],e.tiltData={},e.tiltData.angles=[],e.tiltData.mulFactors=[];function o(t){return t=t.replace(/^\s+|\s+$/g,""),t=t.replace(/,/g," "),t=t.replace(/\s\s+/g," "),t.split(" ")}function l(t,a){for(;;){const s=i[b++],g=o(s);for(let w=0;w<g.length;++w)a.push(Number(g[w]));if(a.length===t)break}}function F(){let t=i[b++],a=o(t);e.tiltData.lampToLumGeometry=Number(a[0]),t=i[b++],a=o(t),e.tiltData.numAngles=Number(a[0]),l(e.tiltData.numAngles,e.tiltData.angles),l(e.tiltData.numAngles,e.tiltData.mulFactors)}function h(){const t=[];l(10,t),e.count=Number(t[0]),e.lumens=Number(t[1]),e.multiplier=Number(t[2]),e.numVerAngles=Number(t[3]),e.numHorAngles=Number(t[4]),e.gonioType=Number(t[5]),e.units=Number(t[6]),e.width=Number(t[7]),e.length=Number(t[8]),e.height=Number(t[9])}function r(){const t=[];l(3,t),e.ballFactor=Number(t[0]),e.blpFactor=Number(t[1]),e.inputWatts=Number(t[2])}for(;p=i[b++],!p.includes("TILT"););p.includes("NONE")||p.includes("INCLUDE")&&F(),h(),r();for(let t=0;t<e.numHorAngles;++t)e.candelaValues.push([]);l(e.numVerAngles,e.verAngles),l(e.numHorAngles,e.horAngles);for(let t=0;t<e.numHorAngles;++t)l(e.numVerAngles,e.candelaValues[t]);for(let t=0;t<e.numHorAngles;++t)for(let a=0;a<e.numVerAngles;++a)e.candelaValues[t][a]*=e.candelaValues[t][a]*e.multiplier*e.ballFactor*e.blpFactor;let d=-1;for(let t=0;t<e.numHorAngles;++t)for(let a=0;a<e.numVerAngles;++a){const s=e.candelaValues[t][a];d=d<s?s:d}if(d>0)for(let t=0;t<e.numHorAngles;++t)for(let a=0;a<e.numVerAngles;++a)e.candelaValues[t][a]/=d}const Pe="https://raw.githubusercontent.com/mrdoob/three.js/r150/examples/textures/equirectangular/royal_esplanade_1k.hdr",U=["https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/0646706b3d2d9658994fc4ad80681dec.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/06b4cfdc8805709e767b5e2e904be8ad.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/007cfb11e343e2f42e3b476be4ab684e.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/01dac7d6c646814dcda6780e7b7b4566.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/108b32f07d6d38a7a6528a6d307440df.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/1aec5958092c236d005093ca27ebe378.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/02a7562c650498ebb301153dbbf59207.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/1a936937a49c63374e6d4fbed9252b29.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/00c6ce79e1d2cdf3a1fb491aaaa47ae0.ies"];let c,S,v,m,P,n,_,L=null,C,y,x;const f={model:be,multipleImportanceSampling:!0,bounces:3,renderScale:1/window.devicePixelRatio,tiles:2,iesProfile:-1,...we()};xe();async function xe(){x=new fe,x.attach(document.body),S=new ae,S.shadowMap.enabled=!0,S.physicallyCorrectLights=!0,S.shadowMap.type=ne,S.toneMapping=oe,document.body.appendChild(S.domElement),c=new ye(S),c.setBVHWorker(new Ae),c.tiles.set(f.tiles,f.tiles),c.textureSize.set(2048,2048),c.filterGlossyFactor=.5;const T=window.innerWidth/window.innerHeight;P=new re(75,T,.025,500),P.position.set(-2,4,8).multiplyScalar(.8),v=new he(P,S.domElement),v.target.y=1.5,v.update(),v.addEventListener("change",()=>c.updateCamera()),m=new se,m.backgroundBlurriness=.1,m.environmentIntensity=.1,m.backgroundIntensity=.1;const e=new Ce,[i,b]=await Promise.all([new ge().loadAsync(Pe),Promise.all(U.map(r=>e.loadAsync(r)))]);_=b,i.mapping=ie,m.environment=i,m.background=i,C=new W(new le(8,8,.5,200),new z({color:5592405,roughness:.05,metalness:.4})),C.geometry=C.geometry.toNonIndexed(),C.geometry.clearGroups(),C.receiveShadow=!0,C.material.color.convertSRGBToLinear(),m.add(C),y=new W(new de(14,6,.5),new z({color:10511460,roughness:.4,metalness:.1})),y.castShadow=!0,y.receiveShadow=!0,y.geometry=y.geometry.toNonIndexed(),y.geometry.clearGroups(),y.position.x=0,y.material.color.convertSRGBToLinear(),m.add(y);async function p(r){const d=G[r];if(!d||!d.url)return;L&&m.remove(L),x.setPercentage(0);const t=new me;t.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.7/");const a=await new ue().setDRACOLoader(t).loadAsync(d.url);t.dispose();const s=a.scene;d.postProcess&&d.postProcess(s),s.scale.setScalar(1),s.updateMatrixWorld(),s.traverse(w=>{w.castShadow=!0,w.receiveShadow=!0}),m.add(s),L=s;const g=new ce;g.setFromObject(s),C.position.y=g.min.y-.25,y.position.y=g.min.y+3,y.position.z=g.min.z-.5,m.updateMatrixWorld(!0),await c.setSceneAsync(m,P,{onProgress:w=>x.setPercentage(w)}),x.setCredits(d.credit||"")}await p(f.model),n=new Se(16777215),n.position.set(0,7,4),n.angle=Math.PI/4.5,n.decay=0,n.penumbra=1,n.distance=0,n.intensity=50,n.radius=.5,n.shadow.mapSize.width=512,n.shadow.mapSize.height=512,n.shadow.camera.near=.1,n.shadow.camera.far=10,n.shadow.focus=1,n.castShadow=!0,m.add(n);const o=n.target;o.position.x=0,o.position.y=C.position.y+2,o.position.z=.05,m.add(o),await c.setSceneAsync(m,P,{onProgress:r=>x.setPercentage(r)}),A(),I(),window.addEventListener("resize",I);const l=new pe;l.add(f,"model",Object.keys(G).sort()).onChange(async r=>{await p(r)});const F=l.addFolder("Path Tracing");F.add(f,"multipleImportanceSampling").onChange(A),F.add(f,"tiles",1,4,1).onChange(r=>{c.tiles.set(r,r)}),F.add(f,"bounces",1,30,1).onChange(A),F.add(f,"renderScale",.1,1).onChange(I);const h=l.addFolder("Spot Light");h.addColor(n,"color").onChange(A),h.add(n,"intensity",0,200,.01).onChange(A),h.add(n,"radius",0,10).onChange(A),h.add(n,"decay",0,2).onChange(A),h.add(n,"distance",0,20).onChange(A),h.add(n,"angle",0,Math.PI/2).onChange(A),h.add(n,"penumbra",0,1).onChange(A),h.add(f,"iesProfile",-1,U.length-1,1).onChange(r=>{n.iesMap=r===-1?null:_[r],A()}),B()}function I(){S.setSize(window.innerWidth,window.innerHeight),S.setPixelRatio(window.devicePixelRatio*f.renderScale),P.aspect=window.innerWidth/window.innerHeight,P.updateProjectionMatrix(),c.updateCamera()}function A(){c.multipleImportanceSampling=f.multipleImportanceSampling,c.bounces=f.bounces,c.updateLights()}function B(){requestAnimationFrame(B),P.updateMatrixWorld(),c.renderSample(),x.setSamples(c.samples,c.isCompiling)}
//# sourceMappingURL=spotLights-BOmfkF78.js.map
